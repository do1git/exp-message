# Day 1 작업 정리 - 2026-01-12

## 오늘 완료된 작업

1. **로그인 컨트롤러 개발** - 로그인 API, E2E 테스트
2. **Auth Util 개발** - `AuthInfo`, `AuthInfoAffect` 어노테이션, 인증 필터
3. **ChatRoom 도메인 구현** - 생성/조회/수정/삭제, E2E 테스트
4. **ChatRoom 권한 검증** - 생성자만 수정/삭제 가능
5. **ChatRoomMember 도메인 구현** - 참가/나가기, 멤버 목록 조회
6. **참여한 채팅방 조회 개선** - N+1 문제 해결
7. **Swagger 자동 Summary** - 메서드 이름 기반 자동 생성
8. **빈 리스트 명시적 처리** - 성능 개선
9. **Message 도메인 구현** - 전송/조회, 권한 검증
10. **Message RESTful API 개선** - 쿼리 파라미터 필터링, E2E 테스트

## 주요 성과

- 인증 인프라 구축 완료
- DDD 기반 3개 도메인 구현 (ChatRoom, ChatRoomMember, Message)
- RESTful 설계 원칙 준수
- 성능 최적화 (N+1 해결, 복합 인덱스)

## 기획 결정

- 메시지 응답에 사용자 정보 제외 (프론트엔드에서 유저 캐싱 활용, API 응답 크기 최소화 및 성능 최적화)
- 메시지 조회 시 권한 검증 없음 (현재는 공개 조회 허용, 추후 private 채팅방에 대해서만 제한 적용 예정)

## 피드백

### 잘한 점
- N+1 문제 해결 (배치 조회로 쿼리 수 N+1 → 2로 감소, 성능 대폭 개선)
- GlobalExceptionHandler로 일관된 에러 처리 (에러 타입별 HTTP 상태 코드 매핑, 유지보수성 향상)
- 인증 인프라 구축 (AuthInfoArgumentResolver에서 토큰 검증 및 사용자 정보 추출)
- 일관된 아키텍처 패턴 적용 (모든 도메인 동일한 레이어 구조)
- 채팅방 생성 시 생성자 자동 멤버 추가 (비즈니스 로직 완성도, 사용자 경험 향상)
- 권한 검증을 Application 레이어에서 수행 (비즈니스 로직 기반 권한 확인, 레이어 책임 분리 명확)
- Repository 패턴으로 도메인-인프라 분리 (toEntity/toDomain 변환 로직 명확)
- 높은 생산성 (하루에 10개 작업 완료, 일관된 패턴으로 빠른 구현)
- 도메인 특성 반영 (Message는 독립 리소스, ChatRoomMember는 하위 리소스)
- 점진적 개선 (RESTful API 개선, E2E 테스트 추가 등 즉시 개선)
- 성능 최적화에 대한 지속적인 개선 (N+1 해결, 빈 리스트 조기 반환)
- 테스트 전략 개선 (HTTP 상태 코드 → `success` 필드 기반 검증)
- Validator를 별도 컴포넌트로 분리 (재사용성 및 테스트 용이성 향상)
- @Transactional 적절히 사용 (readOnly, 일반 트랜잭션 구분)
- RESTful API 설계 (`@GetMapping(params = ["chatRoomId"])`로 경로 충돌 방지)

### 아쉬운 점

#### 핵심 기능 부재
- 메시지 수정/삭제 기능 미구현
- 유저 삭제 기능 미구현
- 🔴 페이징 기능 미지원 (전체 조회로 인한 성능 이슈 가능)
- 🔴 소프트 삭제 미지원 (물리 삭제만 가능, 데이터 복구 불가, 감사 추적 제한)

#### 부가 기능 부재
- 🔴 파일 업로드/다운로드 기능 미구현 (이미지 첨부 등 미지원, 사용자 경험 제한)
- 🔴 실시간 메시지 전송 미구현 (WebSocket 미적용)
- 메시지 검색 기능 없음 (Elasticsearch 계획은 있으나 미구현, 사용자 경험 제한)
- 메시지 읽음 상태 추적 없음 (읽음/안 읽음 상태 관리 없음, 사용자 경험 제한)
- 메시지 타입 제한 (텍스트만 지원, 이미지/파일 등 다양한 타입 미지원)
- 채팅방 초대 기능 없음 (멤버 초대/초대 링크 생성 기능 없음)
- 채팅방 검색 기능 없음 (채팅방 이름/설명 검색 불가)
- 사용자 프로필 수정 기능 없음 (프로필 정보 변경 불가)
- 채팅방 타입 구분 없음 (공개/비공개 채팅방 구분 없음)
- 관리자용 API 없음 (관리자 전용 기능/통계/관리 기능 부재)
- 프론트엔드 미구현 (API만 구현, 실제 사용자 인터페이스 없음)

#### 보안 관련
- 🔴 Rate Limiting/Throttling 없음 (API 보호 및 DDoS 대응 부재, 서비스 안정성 위험)
- 🔴 CORS 설정 없음 (프론트엔드 연동 시 CORS 이슈 가능, 보안 정책 미설정)
- CSRF 비활성화 (개발 환경용 설정, 프로덕션 환경 보안 위험)
- 🔴 외래키 제약조건 없음 (데이터베이스 레벨 참조 무결성 보장 부재)
- AccessToken 즉시 무효화 전략 없음 (로그아웃 시 jti/sid 기준 블랙리스트 미적용, 만료까지 유효한 상태)
- RefreshToken 회전/재사용 탐지 전략 없음 (토큰 패밀리 관리 및 재사용 감지 시 세션 폐기 로직 부재)
- 세션 관리 기능 없음 (세션 목록 조회/특정 세션 강제 로그아웃 기능 부재, 디바이스/UA/IP 메타데이터 저장 없음)
- MySQL SSL 비활성화 (useSSL=false 설정, 프로덕션 환경에서 데이터 전송 암호화 부재)
- 🔴 JWT 시크릿 키 기본값 사용 (please-change-me... 기본값, 프로덕션 환경 보안 위험)
- 비밀번호 정책 약함 (최소 8자만 요구, 복잡도 요구사항 없음)
- UUID 형식 검증 부족 (일부 입력에서 UUID 형식 검증 없어 잘못된 형식 입력 가능)
- 입력값 sanitization 부족 (XSS 방지 등 입력값 정제 로직 부재)
- HTTPS 강제 설정 없음 (HTTP 허용, 프로덕션 환경 보안 위험)
- 🔴 SecurityConfig에서 모든 요청 허용 (permitAll 설정, 개발 환경용이지만 프로덕션 환경 보안 위험)
- Actuator 엔드포인트 보안 설정 부족 (health/info만 노출하지만 추가 보안 설정 필요)

#### 성능/인프라 관련
- 🔴 데이터 캐싱 전략 없음 (Redis는 토큰용으로만 사용, 일반 데이터 캐싱 없어 성능 최적화 기회 상실)
- DB 샤딩/파티셔닝 미고려 (대규모 데이터 처리 시 성능 병목 가능, 수평 확장성 제한)
- 인프라 성능/트래픽 테스트 미실시 (실제 부하 상황 검증 안됨)
- 🔴 모니터링/알림 시스템 연동 없음 (Prometheus/Grafana 인프라는 있으나 실제 연동/메트릭 수집 없음)
- 쿼리 성능 모니터링 없음 (느린 쿼리 감지/분석 도구 없음)
- 데이터베이스 연결 풀 모니터링 없음 (연결 풀 상태 추적 불가)
- 배치 작업/스케줄러 없음 (정기 작업 처리 메커니즘 없음)
- 권한 검증 시 중복 조회 발생 (권한 검증을 위해 getById()를 호출하는데, 이미 조회된 엔티티가 있다면 중복 조회 방지 고려 필요)
- 어노테이션 체크 캐싱 전략 없음 (AuthInfoArgumentResolver에서 어노테이션 체크가 매 요청마다 발생, 캐싱 전략 고려 가능)
- 🔴 CI/CD 파이프라인 없음 (GitHub Actions/GitLab CI 등 자동화된 빌드/테스트/배포 프로세스 부재, 수동 배포로 인한 실수 가능성)
- Docker 빌드 시 테스트 제외 (프로덕션 빌드는 일반적이나 CI/CD에서는 테스트 실행 필요, 빌드 단계에서 테스트 누락 가능)
- Redis 연결 실패 시 fallback 전략 없음 (Redis 장애 시 서비스 전체 장애 가능)
- 데이터베이스 연결 실패 시 재시도 로직 없음 (일시적 네트워크 오류 시 즉시 실패)
- 연결 풀 리소스 정리 로직 없음 (장애 시 연결 풀 리소스 정리 메커니즘 부재)

#### 데이터베이스 관련
- 🔴 DB 마이그레이션 도입 안됨 (Flyway/Liquibase 미사용)
- 트랜잭션 타임아웃 설정 없음 (장시간 실행 쿼리 시 리소스 점유 위험)
- 채팅방 삭제 시 멤버 처리 전략 불명확 (외래키 제약조건 또는 CASCADE 설정 고려 필요)
- 백업/복구 전략 미구현 (binlog 설정은 있으나 실제 복구 프로세스/스크립트 없음, 데이터 손실 시 복구 불가능)
- 🔴 동시성 제어 부재 (낙관적/비관적 락 미사용, 동시 수정 시 데이터 불일치 가능성)

#### 권한/역할 관련
- 🔴 역할(Role) 관리 미구현 (모든 멤버가 동일한 권한, 관리자 역할 추가 필요)
- 권한 검증 로직의 확장성 부족 (하드코딩된 권한 검증, 관리자 권한 추가 시 코드 중복 가능)
- 권한 검증 로직의 재사용성 부족 (update()와 delete()에서 유사한 권한 검증 로직 반복)
- 멤버 수 제한 미구현 (최대 멤버 수 제한 없음)
- 채팅방 나가기 후 재참가 정책 불명확 (명확한 정책 부재)
- 멤버 정보 확장성 부족 (역할, 초대자 정보, 마지막 접속 시간 등 추가 정보 필요)

#### 테스트 관련
- E2E 테스트 초기 부재 (나중에 추가로 보완)
- 테스트 컨테이너 공통 모듈 미구현 (각 테스트에서 개별적으로 컨테이너 설정, 재사용성 부족)
- AuthInfoArgumentResolver 단위 테스트 부재 (컴포넌트 단위 테스트 필요)
- 🔴 통합 테스트 부족 (도메인 간 통합 시나리오 테스트 부재)
- 성능 테스트 부족 (응답 시간, 처리량 등 성능 지표 측정 없음)
- 부하 테스트 부족 (k6 계획은 있으나 실제 부하 테스트 스크립트/시나리오 미구현)

#### 코드 품질/유지보수성
- MessageApplicationService에서 에러 변환 로직 중복 (try-catch 패턴 반복)
- MessageCreateValidator에서 모든 검증 에러가 INVALID_CONTENT로 통일 (에러 타입 구분 부족)
- MessageEntity에 updatedAt 필드 없음 (수정 기능 고려 시 필요)
- MessageRepository에서 Optional 대신 null 반환 (Optional 사용이 더 명확할 수 있음)
- 입력값 검증 이중화 (@Valid와 Validator 모두 사용, 검증 로직 중복 가능)
- Request DTO 검증 어노테이션 부족 (일부 Request DTO에 검증 어노테이션 없음)
- 채팅방 이름 중복 검증 없음 (동일 이름 채팅방 생성 가능)
- 정렬 순서 불명확 (참여한 채팅방 목록 정렬 기준 불명확)
- 기존 메서드 정리 필요 (getByCreatedByUserId 등 deprecated 표시 필요)
- OpenApiConfig 복잡도 높음 (파라미터 제거 로직이 다소 복잡함, 전역 설정 활용 검토 가능)
- Kotlin null 안전성 활용 부족 (AuthInfo?와 AuthInfo 타입 구분을 더 명확하게 처리 가능)
- 배치 조회 시 데이터 불일치 처리 불명확 (findByIds()에서 일부 ID가 존재하지 않을 경우의 처리 로직 불명확, 명시적 처리 권장)
- 🔴 Repository 변환 로직 중복 (toEntity/toDomain 변환 로직이 각 Repository마다 반복, 공통 유틸리티 또는 베이스 클래스 고려)
- API 문서화 부족 (KDoc 주석 부족, Swagger는 있으나 코드 레벨 문서화 미흡)
- 코드 주석 부족 (복잡한 비즈니스 로직에 대한 설명 주석 부재, 유지보수성 저하)
- Dockerfile에서 curl 의존성 누락 가능성 (Alpine 이미지에서 curl이 기본 포함되지 않을 수 있음, 헬스체크 실패 가능)

#### 운영/모니터링 관련
- 🔴 구조화된 로깅 전략 없음 (SLF4J만 사용, 로그 레벨/구조화 전략 없어 디버깅/모니터링 어려움)
- 에러 메시지 언어 일관성 부족 (일부는 영어, 일부는 한국어 혼재)
- 에러 메시지 하드코딩 (다국어 지원 고려 안됨)
- API 버저닝 전략 없음 (API 변경 시 호환성 관리 어려움, 유지보수성 저하)
- Swagger에서 KDoc 기반 처리 안됨 (메서드 이름 기반으로 대체, KDoc 주석을 읽지 못함)
- 🔴 도메인 이벤트 발행 없음 (메시지 생성 시 이벤트 미발행, 실시간 알림/통계/검색 인덱싱 제약)
- 배포/검증 증거 부족 (배포 성공 로그/스크린샷/명령 출력 등 증거 자료 부족, 설득력 저하)
- 문서/파일 네이밍 정리 필요 (중복 문서 및 오타성 파일명 존재, 탐색성 저하)
- 환경별 설정 분리 부족 (dev/staging/prod 환경별 설정 파일 분리 없음, 환경 변수만으로 관리)
- 로깅 수집 파이프라인 없음 (Loki 계획은 있으나 실제 로그 수집/중앙화 파이프라인 미구현, 분산 환경에서 로그 추적 어려움)
- 프로덕션 환경에서 show-sql=true (성능 저하 및 보안 이슈, SQL 쿼리 로그 노출)
- 헬스체크 단순함 (데이터베이스/Redis 연결 상태 확인 없음, 실제 서비스 상태 반영 부족)
- 민감한 정보 로그 노출 가능성 (비밀번호, 토큰 등 민감 정보가 로그에 기록될 위험)
- 타임아웃 예외 처리 없음 (데이터베이스/Redis 타임아웃 시 적절한 에러 응답 부재)
- 설정 검증 로직 없음 (애플리케이션 시작 시 필수 설정값 검증 없음, 런타임 에러 가능)

## 다음 단계

### P0 - 즉시 해결 필요 (보안 위험)

1. ~~**JWT 시크릿 키 기본값 변경** - 프로덕션 환경 보안 위험~~
   - 프로덕션 환경에서는 환경 변수를 통해 다른 키를 사용 중

2. ~~**SecurityConfig 보안 강화** - permitAll 제거, 인증/인가 정책 수립~~
   - Spring Security를 사용하지 않을 뿐, AuthInfoAffect를 사용하여 인증/인가 정책 수립 완료

3. **CORS 설정** - 프론트엔드 연동 시 필수
   - 보류: 추후 프론트엔드 개발 진행 시 지정 예정

4. **Rate Limiting/Throttling** - API 보호 및 DDoS 대응
   - 키워드: Bucket4j, Resilience4j, Redis + Lua 스크립트, Spring Cloud Gateway Rate Limiter

### P1 - 핵심 기능/데이터 무결성

5. ~~**외래키 제약조건 추가** - 데이터베이스 레벨 참조 무결성 보장~~
   - 의도적 미적용: 개발 난이도 증가, 부하 이슈, 추후 DB 분리 시 어려움 고려

6. **DB 마이그레이션 도입** - Flyway/Liquibase 도입, 스키마 버전 관리
   - 키워드: Flyway (SQL + Java 기반 마이그레이션), Liquibase (XML/YAML/SQL/Groovy)
   - 별도 모듈/프로젝트로 분리하여 배치 코드와 함께 관리 (백엔드 코드와 독립적 관리)

7. ~~**동시성 제어** - 낙관적/비관적 락 적용, 동시 수정 방지~~
   - 현재는 동시성 제어가 필요한 시나리오가 크게 없음 (멤버 수 제한 없음, 수정 권한 제한적)
   - 향후 멤버 수 제한, 메시지 수정/삭제 기능 추가 시 필요할 수 있음

8. **페이징 기능** - 전체 조회 성능 이슈 해결
   - 예상 전략: 부하를 효과적으로 줄이기 위해 커서기반 페이징을 고려

9. **소프트 삭제** - 데이터 복구 및 감사 추적 가능
   - 예상 전략: repository 단에서 처리 및 주기적 정리 배치 코드 작성

### P2 - 개발 생산성/코드 품질

10. **CI/CD 파이프라인 구축** - 자동화된 빌드/테스트/배포
    - 키워드: GitHub Actions, GitLab CI/CD, Jenkins, 테스트 자동화, 코드 품질 검사 (SonarQube), 보안 스캔 (Snyk, Trivy)
    - 참고: Docker 이미지 빌드/푸시, Kubernetes 배포, Helm charts는 이미 구현 중

11. **구조화된 로깅 전략** - 로그 레벨/구조화 전략 수립
    - 키워드: JSON 형식 로깅, MDC (Mapped Diagnostic Context), 로그 필드 표준화 (timestamp, level, message, traceId, spanId), 분산 추적 (Distributed Tracing), logstash-logback-encoder, ELK Stack (Elasticsearch, Logstash, Kibana), Loki, LGTM, 로그 샘플링, 로그 마스킹 (민감 정보 제거)

12. **Repository 변환 로직 공통화** - 중복 제거, 유지보수성 향상
    - 키워드: MapStruct, ModelMapper, Dozer, Converter 패턴, Abstract Repository 패턴, Generic Repository 패턴, Base Repository 클래스, Kotlin Extension 함수, 매핑 전략 패턴

13. **통합 테스트** - 도메인 간 통합 시나리오 테스트
    - 키워드: 도메인 간 통합 테스트 (ChatRoom-ChatRoomMember-Message), 레이어 간 통합 테스트 (Controller-Application-Repository), 외부 시스템 통합 테스트 (DB, Redis), 트랜잭션 통합 테스트, 이벤트 기반 통합 테스트, 배치 작업 통합 테스트, API 통합 테스트 (외부 API 연동)
    - 참고: E2E 테스트는 이미 일부 구현 중

### P3 - 성능 최적화/모니터링

14. **모니터링 시스템 연동** - Prometheus/Grafana 메트릭 수집 (성능 최적화 전 선행 필요)

15. **데이터 캐싱 전략** - Redis 활용한 일반 데이터 캐싱
    - 예상 전략: 모니터링 기반 핫 데이터 식별 후 Cache-Aside 패턴 적용 (채팅방 정보, 사용자 정보 등), TTL 기반 자동 만료, 업데이트 시 캐시 무효화, 캐시 키 네이밍 규칙 수립

16. **도메인 이벤트 발행** - 실시간 알림/통계/검색 인덱싱 기반
    - 예상 전략: Spring Events 기반 도메인 이벤트 패턴, 메시지 생성 시 이벤트 발행 (MessageCreated), 비동기 이벤트 핸들러로 실시간 알림/통계/검색 인덱싱 처리, 이벤트 스키마 설계 및 버전 관리

### P4 - 부가 기능

17. **파일 업로드/다운로드** - 이미지 첨부 등 사용자 경험 향상

18. **실시간 메시지 전송** - WebSocket 적용

19. **역할(Role) 관리** - 관리자 역할 추가, 권한 체계 구축
